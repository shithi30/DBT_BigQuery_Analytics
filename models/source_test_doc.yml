sources:
  - name: workspace
    dataset: dbt_smaitra
    # freshness:
    #   warn_after: {count: 1, period: hour}
    #   error_after: {count: 3, period: hour}
    # loaded_at_field: Updated_at
    tables:
      - name: landing_tbl
        identifier: landing_grocery_flyer_items
        columns:
          - name: id
            tests:
              - unique
          - name: flyer_item
            tests:
              - not_null
              - string_not_empty
          - name: offer_price
            tests:
              - not_negative
          - name: platform
            tests:
              - accepted_values:
                  values: ["Loblaws", "RealCanadian", "Foodland", "NoFrills", "Zehrs", "Safeway", "ThriftyFoods", "Sobeys", "Freshco", "IGA"]
              - relationships:
                  to: ref('seed_flyer_grocers')
                  field: platform
      - name: processing_tbl
        identifier: processing_grocery_flyer_items
      - name: serving_tbl
        identifier: serving_grocery_flyer_items
      - name: incremental_tbl
        identifier: incremental_chips_flyer_items
      - name: history_tbl
        identifier: historical_grocery_flyer_summary
      - name: seed_tbl
        identifier: seed_flyer_grocers
      
models:
  - name: processing_grocery_flyer_items
    description: The processed table, with refined timestamps and downstream dependencies
    tests:
      - dbt_expectations.expect_table_row_count_to_equal_other_table:
          compare_model: ref('fleeting_grocery_flyer_items')
      - dbt_expectations.expect_table_row_count_to_equal_other_table:
          compare_model: source('workspace', 'landing_tbl')
        